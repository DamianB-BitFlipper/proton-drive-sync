import React, { useState } from "react";\nimport axios from "axios";\nimport * as crypto from "../utils/crypto";\nimport { createDriveClientFromToken, putEncryptedObject } from "../utils/drive-client";\n\nexport function CreateRepo() {\n  const [status, setStatus] = useState<string | null>(null);\n\n  async function onCreate() {\n    try {\n      setStatus("libsodium ready...");\n      await crypto.ready();\n\n      const token = prompt("Paste Proton Drive OAuth token (for PoC only)");\n      if (!token) { setStatus("token required"); return; }\n\n      const client = await createDriveClientFromToken(token);\n      const repoKey = crypto.genRepoKey();\n\n      const content = new TextEncoder().encode("hello secure world");\n      const payload = crypto.encryptObject(repoKey, content);\n\n      const repoId = cryptoRandomUUID();\n      const objectUID = cryptoRandomUUID();\n      await putEncryptedObject(client, \\\"/Apps/MyService/${repoId}\\\", objectUID, JSON.stringify(payload));\n      setStatus("Uploaded encrypted object to Drive.");\n\n      await axios.post("/api/register-repo", {\n        repoId,\n        ownerId: "demo-owner",\n        driveRootPath: \\\"/Apps/MyService/${repoId}\\\"\n      });\n\n      setStatus("Repo registered on metadata server.");\n\n      const ownerPub = prompt("Paste owner's public key (base64) for wrapped key (PoC)");\n      if (!ownerPub) { setStatus("Owner public key required to upload wrapped key"); return; }\n      const wrapped = crypto.wrapKeyForRecipient(repoKey, ownerPub);\n\n      await axios.post("/api/upload-wrapped-key", {\n        id: cryptoRandomUUID(),\n        repoId,\n        recipientId: "demo-owner",\n        ciphertext: wrapped\n      });\n\n      setStatus("Wrapped key uploaded. PoC complete.");\n    } catch (err) {\n      setStatus("Error: " + String(err));\n    }\n  }\n\n  return (\n    <div>\n      <button onClick={onCreate}>Create Encrypted Repo (PoC)</button>\n      {status && <pre>{status}</pre>}\n    </div>\n  );\n}\n\nfunction cryptoRandomUUID() {\n  if (typeof crypto !== "undefined" && "randomUUID" in crypto) {\n    return crypto.randomUUID();\n  }\n  return "uid-" + Math.random().toString(36).slice(2, 10);\n}